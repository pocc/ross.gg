{{ define "main" }}
<article class="max-w-3xl mx-auto px-4 sm:px-6 py-12">
  <header class="mb-8">
    <div class="flex items-center gap-3 mb-4">
      {{ with .Params.stage }}
      <span class="stage-badge stage-{{ . }}">{{ . }}</span>
      {{ end }}
      <time class="text-sm" style="color: var(--fg-faint);" datetime="{{ .Date.Format "2006-01-02" }}">
        {{ .Date.Format "Jan 2, 2006" }}
      </time>
      {{ if ne (.Lastmod.Format "2006-01-02") (.Date.Format "2006-01-02") }}
      <span class="text-sm" style="color: var(--fg-faint);">
        &middot; tended {{ .Lastmod.Format "Jan 2, 2006" }}
      </span>
      {{ end }}
    </div>
    <h1 class="font-display text-3xl font-bold" style="letter-spacing: -0.01em;">{{ .Title }}</h1>
  </header>

  <div class="prose max-w-none">
    {{ .Content }}
  </div>

  {{ with .Params.tags }}
  <div class="mt-8 flex flex-wrap gap-2">
    {{ range . }}
    <a href="/tags/{{ . | urlize }}/" class="text-xs px-2 py-1 rounded-full transition-opacity hover:opacity-80"
       style="background: var(--card-bg); border: 1px solid var(--card-border);">{{ . }}</a>
    {{ end }}
  </div>
  {{ end }}

  {{ with .Params.related }}
  <div class="mt-8 pt-6" style="border-top: 1px solid var(--card-border);">
    <h3 class="text-sm font-medium uppercase tracking-wider mb-3" style="color: var(--fg-muted);">Related</h3>
    <ul class="space-y-2">
      {{ range . }}
      {{ with $.Site.GetPage . }}
      <li>
        <a href="{{ .RelPermalink }}" style="color: var(--accent);">{{ .Title }}</a>
      </li>
      {{ end }}
      {{ end }}
    </ul>
  </div>
  {{ end }}

  {{ partial "backlinks.html" . }}
</article>
{{ end }}
