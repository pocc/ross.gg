<!-- Client-side hydration for Worker API data -->
<script>
(function () {
  function el(tag, classes, style, text) {
    var node = document.createElement(tag);
    if (classes) node.className = classes;
    if (style) node.setAttribute('style', style);
    if (text) node.textContent = text;
    return node;
  }

  // --- /api/status ---
  var statusEl = document.getElementById('live-status');
  if (statusEl) {
    fetch('/api/status')
      .then(function (r) { return r.json(); })
      .then(function (d) {
        if (d.status) {
          statusEl.textContent = d.status;
          if (d.location) statusEl.textContent += ' \u00b7 ' + d.location;
        }
      })
      .catch(function () {});
  }

  // --- /api/github ---
  var ghEl = document.getElementById('github-activity');
  if (ghEl) {
    fetch('/api/github')
      .then(function (r) { return r.json(); })
      .then(function (events) {
        if (!Array.isArray(events) || events.length === 0) return;
        var frag = document.createDocumentFragment();
        events.forEach(function (e) {
          var repo = e.repo.replace(/^pocc\//, '');
          var d = new Date(e.date);
          var ago = Math.floor((Date.now() - d.getTime()) / 86400000);
          var when = ago === 0 ? 'today' : ago === 1 ? 'yesterday' : ago + 'd ago';
          var row = el('div', 'text-sm mb-1', 'color: var(--fg-muted);');
          row.appendChild(el('span', null, 'color: var(--fg);', e.type));
          row.appendChild(document.createTextNode(' ' + repo + ' '));
          row.appendChild(el('span', null, 'color: var(--fg-faint);', when));
          frag.appendChild(row);
        });
        var link = el('a', 'text-sm font-medium hover:opacity-80 transition-opacity', 'color: var(--accent);');
        link.href = '{{ .Site.Params.social.github | safeJS }}';
        link.textContent = '@pocc \u2192';
        frag.appendChild(link);
        ghEl.textContent = '';
        ghEl.appendChild(frag);
      })
      .catch(function () {});
  }

  // --- /api/stackoverflow ---
  var soEl = document.getElementById('so-rep');
  if (soEl) {
    fetch('/api/stackoverflow')
      .then(function (r) { return r.json(); })
      .then(function (d) {
        if (!d.reputation) return;
        var frag = document.createDocumentFragment();
        frag.appendChild(el('div', 'text-2xl font-bold mb-1', 'color: var(--fg);', d.reputation.toLocaleString()));
        frag.appendChild(el('div', 'text-sm mb-2', 'color: var(--fg-muted);', 'reputation'));
        if (d.badges) {
          var badges = el('div', 'flex gap-3 text-xs mb-2');
          badges.appendChild(el('span', null, 'color: #FFD700;', '\u25cf ' + d.badges.gold));
          badges.appendChild(el('span', null, 'color: #C0C0C0;', '\u25cf ' + d.badges.silver));
          badges.appendChild(el('span', null, 'color: #CD7F32;', '\u25cf ' + d.badges.bronze));
          frag.appendChild(badges);
        }
        var link = el('a', 'text-sm font-medium hover:opacity-80 transition-opacity', 'color: var(--accent);');
        link.href = '{{ .Site.Params.social.stackoverflow | safeJS }}';
        link.textContent = 'View profile \u2192';
        frag.appendChild(link);
        soEl.textContent = '';
        soEl.appendChild(frag);
      })
      .catch(function () {});
  }
})();
</script>
